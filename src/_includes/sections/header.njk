<header class="py-4 ~px-4/8 absolute flex w-full z-50 bg-white border-b-dashed-custom">
  <div class="container m-auto flex justify-between items-center gap-8">
    <!-- LOGO -->
    <a href="/">
      <img 
        src="/assets/svgs/logo-long-red.svg" 
        alt="Tessuti logo" 
        class="h-12 lg:h-20 w-auto object-contain"
        draggable="false">
    </a>

    <!-- NAVIGATION -->
    <nav class="max-lg:hidden max-lg:group-[.mobile-menu]/body:block max-lg:absolute max-lg:top-[calc(100%+0.5rem)] max-lg:left-1/2 max-lg:-translate-x-1/2
      max-lg:w-[calc(100vw-2rem)] max-lg:p-4 max-lg:bg-white max-lg:border-2 max-lg:border-black max-lg:rounded-lg">
      <ul class="flex max-lg:flex-col ~gap-2/8">
        {% set navPages = collections.all | eleventyNavigation %}

        {# Loop through all pages with a eleventyNavigation in the frontmatter #}
        {% for entry in navPages %}

          {# Define a hasChild variable to make it easier to test what navigation items are have child dropdown pages #}
          {% set hasChild = entry.children.length %}

          <li
            class="group/li {% if hasChild -%} dropdown relative {%- else -%} inline-flex {%- endif %}"
            {%- if hasChild -%}tabindex="0"{%- endif -%}
          >

            {# If the page has child dropdown pages, render it as a link + button combination #}
            {% if hasChild %}
              {# Container for the link and dropdown button #}
              <div class="flex items-center">
                {# Main katalog link #}
                <a
                  class="~p-1.5/4 whitespace-nowrap transition-colors duration-300 text-xl font-body max-lg:pl-4 max-lg:border-l-4 max-lg:rounded-r-md
                  {%- if entry.url == page.url %} text-[#E92429] font-semibold text-2xl max-lg:border-l-[#E92429] max-lg:bg-primary/10
                  {%- else %} text-black hover:text-gray-600 hover:underline decoration-dashed{% endif %}"
                  href="{{ entry.data.eleventyNavigation.url or entry.url }}"
                  {%- if entry.url == page.url -%}aria-current="page"{%- endif -%}>
                  {{ entry.key }}
                </a>
                
                {# Dropdown toggle button #}
                <button
                  class="dropdown-button px-2 py-1 text-black hover:text-gray-600 transition-colors duration-300"
                  aria-expanded="false"
                  aria-controls="dropdown-{{ entry.key | slug }}"
                  aria-label="Otevřít submenu {{ entry.key }}"
                  type="button"
                >
                  <!-- DROPDOWN ICON -->
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="transition-transform duration-300" viewBox="0 0 16 16">
                    <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                  </svg>
                </button>
              </div>

              {# Dropdown menu positioned absolutely below the li element #}
              <div class="dropdown-menu
                absolute top-full left-0 z-50 mt-2
                transition-[transform,_opacity] duration-300 lg:scale-y-0 lg:opacity-0 origin-top lg:group-hover/li:scale-y-100 lg:group-hover/li:opacity-100
                max-lg:static max-lg:w-full max-lg:h-0 max-lg:group-[&.active]/li:h-auto max-lg:mt-0">
                <ul
                  id="dropdown-{{ entry.key | slug }}"
                  class="flex flex-col bg-white rounded-lg shadow-lg border border-gray-200 py-2 min-w-[200px]
                    max-lg:bg-transparent max-lg:shadow-none max-lg:border-none max-lg:py-0 max-lg:min-w-0
                    max-lg:hidden max-lg:group-[&.active]/li:flex max-lg:gap-1 max-lg:mt-2 max-lg:mb-4 max-lg:ml-4"
                >
                {% for child in entry.children %}
                  <li class="drop-li lg:transition-[transform,_opacity] lg:duration-200 lg:opacity-0 lg:translate-x-4 lg:group-hover/li:opacity-100 lg:group-hover/li:translate-x-0"
                    style="transition-delay: {{ 100 + 50 * loop.index }}ms;"
                  >
                    <a
                      href="{{ child.url }}"
                      class="li-link block w-full lg:px-4 lg:py-2 max-lg:pl-4 max-lg:py-1 text-sm font-semibold font-body max-lg:border-l-4
                      {%- if child.url == page.url %} text-[#E92429] max-lg:border-l-[#E92429] max-lg:bg-[#E92429]/10 lg:bg-[#E92429]/10
                      {%- else %} text-gray-700 transition-colors duration-200 hover:text-[#E92429] lg:hover:bg-gray-50
                      max-lg:hover:bg-gray-100 max-lg:border-l-gray-300 max-lg:focus:text-black{% endif %}"
                      {%- if child.url == page.url -%}aria-current="page"{%- endif -%}
                    >
                      {{ child.key }}
                    </a>
                  </li>
                {% endfor %}
              </ul>
              </div>
            {% else %}
              {# Normal pages are rendered as <a> tags, in the normal way you'd expect #}
              <a
                class="w-full ~p-1.5/4 whitespace-nowrap transition-colors duration-300 text-xl font-body max-lg:pl-4 max-lg:border-l-4 max-lg:rounded-r-md
                {%- if entry.url == page.url %} text-[#E92429] font-semibold text-2xl max-lg:border-l-[#E92429] max-lg:bg-primary/10
                {%- else %} text-black hover:text-gray-600 hover:underline decoration-dashed{% endif %}"
                href="{{ entry.data.eleventyNavigation.url or entry.url }}"
                {%- if entry.url == page.url -%}aria-current="page"{%- endif -%}>
                {{ entry.key }}
              </a>
            {% endif %}
          </li>
        {% endfor %}
        
        {# Add Kontakt button for mobile menu #}
        <li class="lg:hidden">
          <a
            href="/#contact-form"
            class="w-1/3 p-3 mt-4 bg-[#00A44F] text-white text-center rounded-lg font-body font-medium transition-colors duration-300 hover:bg-[#008f43] block">
            Kontakt
          </a>
        </li>
      </ul>
    </nav>

    <!-- DARKMODE + CTA -->
    <div class="flex items-center gap-2 lg:gap-4">
      <!-- CTA -->
      <a href="/#contact-form" class="btn max-lg:hidden bg-[#00A44F] rounded-lg font-body">Kontakt</a>

      <!-- MOBILE MENU BUTTON -->
      <button
        id="mobile-menu-toggle"
        class="group lg:hidden flex justify-center items-center gap-1 h-11 w-11 bg-secondary rounded-xl transition-transform duration-300 [&.active]:rotate-90"
        type="button"
        aria-expanded="false"
      >
        <span class="sr-only">Otevřít navigaci</span>
        <span class="relative block h-3.5 w-5">
          <span class="absolute top-0 block h-0.5 w-full bg-black rounded-full transition-transform duration-300 group-[.active]:rotate-45 group-[.active]:top-1/2 group-[.active]:-translate-y-1/2 group-[.active]:left-1/2 group-[.active]:-translate-x-1/2"></span>
          <span class="absolute top-1/2 -translate-y-1/2 block h-0.5 w-full bg-black rounded-full transition-[opacity] duration-300 group-[.active]:opacity-0"></span>
          <span class="absolute bottom-0 block h-0.5 w-full bg-black rounded-full transition-transform duration-300 group-[.active]:rotate-[315deg] group-[.active]:top-1/2 group-[.active]:-translate-y-1/2 group-[.active]:left-1/2 group-[.active]:-translate-x-1/2"></span>
        </span>
      </button>
    </div>
  </div>
</header>